<!doctype html>
<html>
    <head lang="en-us">
        <title>Make front-end unit tests easy with karma</title>

        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="http://ralphsaunders.co.uk/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="ralphsaunders.co.uk - Full Atom Feed" />
<link href="http://ralphsaunders.co.uk/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="ralphsaunders.co.uk - Full RSS Feed" />

        <!-- Stylesheets -->
        <link rel="stylesheet" href="./theme/css/build/compiled.css" />

        <!-- Typekit -->
        <script>
            (function(d) {
                var config = {
                    kitId: 'umd0yin',
                    scriptTimeout: 3000
                },
                h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='//use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
            })(document);
        </script>

    </head>
    <body class="">

        <noscript>
            <div class="javascript-disabled">
                <div class="wrapper">
                    <h2>Hey, we noticed you have javascript disabled in your
                        browser.</h2>
                    <p>Enable javascript in your browser to fully experience this
                    website. <a href="http://enable-javascript.com/"
                        target="_blank">Here are some handy instructions!</a></p>
                </div>
            </div>
        </noscript>

<nav class="hero-navigation">
    <div class="hero-nav-wrap">
        <ul class="page-list">
            <li class="logo-wrap index">
            <a class="logo-link" href="." title="Take me home!"><img src="./theme/images/build/ralphsaunders-logo.png" alt="" /></a>
            </li>
        </ul>
    </div>
</nav>
<article class="article cf">
    <header>
        <h1 class="title">Make front-end unit tests easy with karma</h1>

        <div class="summary">
            
        </div>
    </header>

    <p>Unit tests are good but can sometimes be a pain to work with. It doesn't have to
be this way though! With a good workflow unit testing should actually help
development rather than hinder it. With that in mind, front-end unit tests should:</p>
<ul>
<li>Source their dependencies without manual mangement</li>
<li>Run when code changes</li>
<li>Run in real browsers</li>
<li>Be easy to interactively debug</li>
</ul>
<h2>Introducing Karma</h2>
<p><a href="http://karma-runner.github.io/0.12/index.html">Karma test runner</a> is a node
package that manages the running of unit tests and solves the issues above.</p>
<p>Setup is pretty straight forward and for the most part self-explanatory. They do
have a <a href="http://karma-runner.github.io/0.12/config/configuration-file.html">page about it on their website
though</a>.</p>
<p>Below is a Karma configuration file, some things to note:</p>
<ul>
<li>I'm using Jasmine for my unit tests</li>
<li>I'm not loading my files using a pattern like <code>/Source/Scripts/**/**/*.js</code>
  because they need to be loaded in a specific order.</li>
<li>Karma is going to run unit tests in the browsers defined. These browsers must
  be setup and ready to load web pages!</li>
<li>I've set singleRun to false. This means the tests will re-run in the browser
  every time one of the files changes.</li>
</ul>
<p><strong>karma.local.conf.js:</strong></p>
<div class="highlight"><pre><span class="c1">// Karma configuration</span>
<span class="c1">// Generated on Tue Oct 28 2014 17:03:28 GMT+0000 (GMT Standard Time)</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span>

    <span class="c1">// base path that will be used to resolve all patterns (eg. files, exclude)</span>
    <span class="nx">basePath</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>


    <span class="c1">// frameworks to use</span>
    <span class="c1">// available frameworks: https://npmjs.org/browse/keyword/karma-adapter</span>
    <span class="nx">frameworks</span><span class="o">:</span> <span class="cp">[</span><span class="s1">&#39;jasmine&#39;</span><span class="cp">]</span><span class="p">,</span>


    <span class="c1">// list of files / patterns to load in the browser</span>
    <span class="nx">files</span><span class="o">:</span> <span class="cp">[</span>
        <span class="s1">&#39;Source/Scripts/lib/bluebird-2.3.11.js&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Source/Scripts/lib/lodash-2.4.1.compat.min.js&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Source/Scripts/angular.js&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Source/Scripts/angular-mocks.js&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Source/Scripts/angular-animate.js&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Source/Scripts/lib/angular-google-maps.min.js&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Source/Scripts/lib/*.js&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Source/Scripts/app/**/*.js&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Source/Scripts/tests/**/*.js&#39;</span>
    <span class="cp">]</span><span class="p">,</span>


    <span class="c1">// list of files to exclude</span>
    <span class="nx">exclude</span><span class="o">:</span> <span class="cp">[</span>
      <span class="s1">&#39;gulpfile.js&#39;</span>
    <span class="cp">]</span><span class="p">,</span>


    <span class="c1">// preprocess matching files before serving them to the browser</span>
    <span class="c1">// available preprocessors: https://npmjs.org/browse/keyword/karma-preprocessor</span>
    <span class="nx">preprocessors</span><span class="o">:</span> <span class="p">{</span>
    <span class="p">},</span>


    <span class="c1">// test results reporter to use</span>
    <span class="c1">// possible values: &#39;dots&#39;, &#39;progress&#39;</span>
    <span class="c1">// available reporters: https://npmjs.org/browse/keyword/karma-reporter</span>
    <span class="nx">reporters</span><span class="o">:</span> <span class="cp">[</span><span class="s1">&#39;progress&#39;</span><span class="cp">]</span><span class="p">,</span>


    <span class="c1">// web server port</span>
    <span class="nx">port</span><span class="o">:</span> <span class="mi">9876</span><span class="p">,</span>


    <span class="c1">// enable / disable colors in the output (reporters and logs)</span>
    <span class="nx">colors</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>


    <span class="c1">// level of logging</span>
    <span class="c1">// possible values: config.LOG_DISABLE || config.LOG_ERROR || config.LOG_WARN || config.LOG_INFO || config.LOG_DEBUG</span>
    <span class="nx">logLevel</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">LOG_INFO</span><span class="p">,</span>


    <span class="c1">// enable / disable watching file and executing tests whenever any file changes</span>
    <span class="nx">autoWatch</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>


    <span class="c1">// start these browsers</span>
    <span class="c1">// available browser launchers: https://npmjs.org/browse/keyword/karma-launcher</span>
    <span class="nx">browsers</span><span class="o">:</span> <span class="cp">[</span><span class="s1">&#39;Firefox&#39;</span><span class="p">,</span> <span class="s1">&#39;Chrome&#39;</span><span class="p">,</span> <span class="s1">&#39;IE&#39;</span><span class="cp">]</span><span class="p">,</span>


    <span class="c1">// Continuous Integration mode</span>
    <span class="c1">// if true, Karma captures browsers, runs the tests and exits</span>
    <span class="nx">singleRun</span><span class="o">:</span> <span class="kc">false</span>
  <span class="p">});</span>
<span class="p">};</span>
</pre></div>


<h2>Karma + Gulp</h2>
<p>Running Karma from the cli directly is a bit of a chore, especially when the
arguments are probably going to be the same most of the time. Here's how I'm
using it with gulp:</p>
<div class="highlight"><pre><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;local-test&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">karma</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span>
        <span class="nx">configFile</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/karma.local.conf.js&#39;</span>
    <span class="p">},</span> <span class="nx">done</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>


<p>Compare that with the task the build environment runs on our project:</p>
<div class="highlight"><pre><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;remote-test&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">karma</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span>
        <span class="nx">configFile</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/karma.conf.js&#39;</span><span class="p">,</span>
        <span class="nx">singleRun</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">reporters</span><span class="o">:</span> <span class="s1">&#39;teamcity&#39;</span>
    <span class="p">},</span> <span class="nx">done</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>


<p>I'm overwriting a few variables in the karma config as part of the remote gulp
task. I only want the test to run once and we want karma to output using the
<a href="https://www.jetbrains.com/teamcity/">TeamCity</a> reporter. TeamCity is the build
environment, and this means the output is present in TeamCity's build log.</p>

    <p class="twitter-cta">
        <a href="https://twitter.com/ralphsaunders" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @ralphsaunders</a>
    <p>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</article>

<div class="hero-footer">
    <div class="hero-footer-wrap">
        <p>This website has the <a href="http://twitter.com/leighdarlow">Leigh Darlow</a> seal of approval</p>
        <p class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>.</p>
    </div>
</div>
        <!-- Javascript -->
        <script src="./theme/js/scripts.js"></script>

        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-57038003-1', 'auto');
          ga('send', 'pageview');

        </script>

    </body>
</html>